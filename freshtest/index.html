<!doctype html>
<html>

<head>
	<title>Hush Hush</title>
</head>

<body>

	<h1>Snarkjs client example</h1>
	<button id="bGenProof"> Create proof </button>

	<!-- JS-generated output will be added here. -->
	<pre class="proof"> Proof: <code id="proof"></code></pre>
	<pre class="proof"> Result: <code id="result"></code></pre>

	<script src="./snarkjs.min.js">   </script>
	<script src="https://cdn.ethers.io/lib/ethers-5.0.umd.min.js" type="application/javascript"></script>
	<script src="./abi/IERC20.json"></script>

	<!-- This is the bundle generated by rollup.js -->
	<script>
		const KOVAN_ADDRESSES = {
			"weth": "0xd0a1e359811322d97991e03f863a0c30c2cf029c",
			"aweth": "0x87b1f4cf9bd63f7bbd3ee1ad04e8f52540349347",
			"aavepool": "0x208Aae127963261f4899B66aC6270B883F8865aC"
		}

		let provider;
		let signer;

		function getAddr(signer) {
			return signer.provider.provider["selectedAddress"];
		}

		async function getTokenBalance(_token) {
			console.log(_token, " at ", KOVAN_ADDRESSES[_token]);

		}

		async function testETh() {
			await window.ethereum.enable();
			provider = new ethers.providers.Web3Provider(window.ethereum);
			signer = provider.getSigner();
			console.log("Logged in as: ", getAddr(signer));

			/*			await signer.signMessage("Hello World").then((res) => {
							console.log("Signature: ", res);
						}).catch((err) => {
							console.log(err);
						});*/
		}

		testETh();

		async function getBalance(_addr) {

		}
		
		const proofCompnent = document.getElementById('proof');
		const resultComponent = document.getElementById('result');
		const bGenProof = document.getElementById("bGenProof");

		bGenProof.addEventListener("click", calculateProof);

		async function calculateProof() {

			let input = {
				withdrawAmount: '2550',
				root: '12611374798853774127170958017711925175539244494343783418312955993182091369066',
				oldSecret: '160206702913346279357650830065569501026599550659606679064687700672866059778',
				oldNonce: '250531632200718281365348202467840769999015635890729291811434872777960715254',
				oldBalance: '8868893577260760485',
				index: 0,
				pathElements: [
					'8877129089590588931191179717681239997003187255881182901397096141227600559306',
					'6065743353373527188733941619422376759386866208426343851409916299020559785092',
					'3178373471808529071645022128064766283194812385416022910843417801811970836178'
				],
				secret: '125608322221168183698447418567758588844167739506571974174103414217326053409',
				nonce: '446585667068114402981376999221167030607130960951846563060389744897156627279',
				fee: '5',
				receiver: '1233613445282242885482293056806396109695098267920'
			}

			const { proof, publicSignals } =
				await snarkjs.groth16.fullProve(input, "./withdraw.wasm", "./withdraw_final.zkey");

			proofCompnent.innerHTML = JSON.stringify(proof, null, 1);


			const vkey = await fetch("./verification_key.json").then(function (res) {
				return res.json();
			});

			const res = await snarkjs.groth16.verify(vkey, publicSignals, proof);

			resultComponent.innerHTML = res;
		}

	</script>

</body>

</html>